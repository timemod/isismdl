% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/IsisMdl_doc.R
\name{fill_mdl_data_solve}
\alias{fill_mdl_data_solve}
\title{\code{\link{IsisMdl}} method: Calculate missing model data by numerical solution.}
\arguments{
\item{period}{A \code{\link[regts]{period}} range object specifying the
period using to replace missing values by evaluating the equations.
If missing, uses the model's data period obtained via \verb{$get_data_period()}.}

\item{solve_df}{A data frame defining the solve specification. Must contain
the following columns:
\describe{
\item{solve_period}{Character specifying the solve period according
to the format of function \code{\link[regts]{period}} of the \code{regts} package
(e.g. \code{"2014"} or \code{"2015Q1"})}
\item{observed_variable}{Name of the variable with observed data}
\item{solve_variable}{Name of the variable to solve for (derive)}
\item{group}{(Optional) Group identifier for solving multiple variables together.
If omitted, each row is treated as a separate group}
\item{initial_guess}{(Optional) Initial guess for the solve variable.
Should be all numeric, including NA's.
Defaults to \code{default_initial_guess} value.}
}}

\item{default_initial_guess}{(Optional) For rows in solve_df that do not have an
initial guess, the default initial guess value will be used.
Default is 0.1.}

\item{report}{Character string controlling output verbosity. Options:
\describe{
\item{"period"}{Print a report per period (default).
For each period the number of replaced missing values is reported.}
\item{"minimal"}{Print a minimal report.
Only the total number of replaced missing values is reported.}
\item{"no"}{Does not generate a report.}
Defaults to \code{period} if not provided.
}}

\item{jacobian}{A logical. If \code{TRUE} and \code{report == "period"}, the
final jacobian used for the numerical solution is printed. The default is \code{TRUE}.}

\item{...}{Additional arguments passed to the \code{nleqslv} solver (e.g., \code{control},
\code{method}, \code{global}).}
}
\value{
An \code{IsisMdl} object (copy of the original model) with solved values for
the solve variables. The original model remains unchanged.
}
\description{
This method can be used to calculate missing model data. This is mainly
used to calculate 'starting values', i.e. the values of endogenous variables
with lags in the period before the solution period of the model.

Like in method \code{\link{fill_mdl_data}}, the missing values are computed by evaluating
the active equations in solution order. Additionally, variables can be solved
numerically. For example, suppose that the model contains the equations

\if{html}{\out{<div class="sourceCode">}}\preformatted{ident y = y[-1];
ident obs = y + z;
}\if{html}{\out{</div>}}

and  we need the value of \code{y} in 2015. If the values of  \code{obs} and \code{z} are
known in 2015, the value of \code{y} in 2015 can be computed by using the inverse of
equation for \code{obs} (\code{y = obs - z}). Method \code{fill_mdl_data_solve} can be used to solve this
numerically. The numerical solution process involves finding the value of \code{y[2015]}
(the value of \code{y} in 2015) such that the difference between equation value for the
equation for \code{obs} in 2015 and the value of  \code{obs[2015]} is zero.

For the example above, a single equation (\code{obs}) has to be evaluated during
the solution process. In general, there can be more than one equation that
connects the value to solve to an observed value. Function \code{fill_mdl_data_solve}
automatically determines which equations have to be evaluated. For a given period,
an equation is only evaluated  when the value of the left hand side variable is \code{NA}.

The function uses the following procedure:
\itemize{
\item First all active equations are evaluated in solution order for the
periods specified with argument \code{period}. The equation values are used
to replace missing values for the left hand side variable.
\item Then for each year, the variables specified in argument \code{solve_df} are
solved numerically. For this we employ function \code{\link[nleqslv]{nleqslv}}
from \code{nleqslv} package.
\item Finally, all active actions are again evaluated in solution order and the
result is used to replace any further missing values.
}

The method is designed for situations where:
\itemize{
\item You have observed data for certain variables in the period before the
solution period of the model.
\item You need to compute lagged values to use as starting values.
\item Exogenous variables are already known for all periods.
\item The  observed data should remain unchanged. \code{fill_mdl_data_solve}
(like \code{fill_mdl_data}) will never replace a non-missing value with
a new value.
}

Note: This method is primarily designed to compute starting values.
For solving exogenous variables, use the separate \code{solve_exo} method.
This method does not support models with feedback variables.
}
\examples{
library(isismdl)
model_text <- "
ident y = y[-1];
ident obs = y + z;
"

# We want to solve the model in  period 2017/2018
mdl <- isis_mdl(model_text = model_text, period = "2017/2018", silent = TRUE)

# Create initial data: z is known, obs is observed only in 2016
mdl$set_values(6:8, names = "z", period = "2016/2018")
mdl$set_values(100, names = "obs", period = "2016")

mdl_copy <- mdl$copy() # Using in a later example

print(mdl$get_data())

# We cannot solve starting from 2017, because y(2016) is missing
mdl$solve()

# Solve for y(2016) based on obs(2016) = 100
library(tibble)
solve_df <- tribble(
    ~solve_period, ~group, ~observed_variable, ~solve_variable, ~initial_guess,
    "2016", "A", "obs", "y", 0.1
)
mdl$fill_mdl_data_solve(
    period = "2016",
    solve_df = solve_df,
    report = "period"
)


print(mdl$get_data())

# Now we can solve starting from 2017
mdl$solve()

# Example with custom solver options
mdl_copy$fill_mdl_data_solve(
    solve_df = solve_df,
    report = "period",
    control = list(trace = 1, maxit = 200)
)


}
\seealso{
Related methods: \code{\link{solve}}, \code{\link{fill_mdl_data}}, \code{\link{get_dep_struct}}
\code{\link[nleqslv]{nleqslv}} for details on the numerical solver and options.
}
